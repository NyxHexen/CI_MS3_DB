{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col s12 m10 push-m1 l8 push-l2">
        <div class="post card grey lighten-1">
            <div class="card-panel z-depth-1 valign-wrapper">
                <div class="col s3 m2">
                    <img src="{{ post.created_by.profile_image }}" alt="User's profile picture"
                        class="circle responsive-img">
                </div>
                <div class="col s10">
                    <a href="#">{{ post.created_by.username }}</a>
                    <span class="grey-text">{{ post.created_date }}</span>
                    <div class="card-title-container">
                        <span class="card-title flow-text">{{ post.post_title }}</span>
                    </div>
                </div>
            </div>
            <p class="card-content">{{ post.post_content }}</p>
            {% if post.code_content %}
            <div class="card-content code-content">
                <div class="chip black-text">{{ post.code_language }}</div>
                <pre
                    class="z-depth-2"><code class="language-{{ post.code_language }}">{{ post.code_content }}</code></pre>
            </div>
            {% endif %}
            <div class="card-action grey lighten-2 z-depth-1">
                {% if post.post_type == "post" %}
                <div class="waves-effect waves-dark btn-flat vote-button"><i
                        class="material-icons right green-text">thumb_up</i>{{ post.votes.up|length }}</div>
                <div class="waves-effect btn-flat vote-button"><i
                        class="material-icons right small red-text">thumb_down</i>{{ post.votes.down|length }}
                </div>
                <a class="waves-effect waves-light btn right">Reply</a>
                <div class="waves-effect btn-flat right">
                    <i class="material-icons right small grey-text text-darken-2">chat</i>
                    <span>{{ post.comments|length }}
                        {% if post.comments|length == 1 %} comment {% else %} comments {% endif %}</span>
                </div>
                {% else %}
                <a class="waves-effect waves-light deep-purple darken-3 btn white-text">Assist</a>
                <div class="waves-effect btn-flat right">
                    <i class="material-icons small grey-text text-darken-2 right">chat</i>
                    <span>{{ post.comments|length }} {% if post.comments|length == 1 %} assist {% else %} assists {% endif %}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<div class="row">
    {% for comment in post.comments %}
    <div class="comment col s12 m10 push-m1 l8 push-l2">
        <div class="card col grey lighten-2">
            <div class="col hide-on-small-only m2 comment-user-info center-align">
                <img src="{{ comment.created_by.profile_image }}" alt="User's profile picture"
                    class="circle responsive-img">
            </div>
            <div class="col s12 m8 card-content">
                <a href="#">{{ comment.created_by.username }}</a>
                <span class="grey-text">{{ comment.created_date }}</span>
            </div>
            <div class="col s12 m8 card-content">
                <p>{{ comment.comment_content }}</p>
            </div>
            {% if comment.code_language and comment.code_content %}
            <div class="col s12 m10 card-content">
                <div class="chip black-text">{{ comment.code_language }}</div>
                <pre
                    class="z-depth-2"><code class="language-{{ comment.code_language }}">{{ comment.code_content }}</code></pre>
            </div>
            {% endif %}
            <div class="col s12 card-action">
                <div class="waves-effect btn-flat vote-button">
                    <i class="material-icons right green-text">thumb_up</i>{{ post.votes.up|length }}
                </div>
                <div class="waves-effect btn-flat vote-button">
                    <i class="material-icons right small red-text">thumb_down</i>{{ post.votes.down|length }}
                </div>
                <a class="waves-effect waves-light btn-flat right">Reply</a>
                <div class="waves-effect btn-flat right">
                    <i class="material-icons right small grey-text text-darken-2">chat</i>
                    <span>{{ comment.comments|length }}</span>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% if form %}
<div class="row">
    <form id="new_comment" class="col s12 m10 push-m1 l8 push-l2 center-align new" method="POST">
        <fieldset class="card valign-wrapper">
            {{ form.hidden_tag() }}
            <legend class="visually-hidden">Post Comment</legend>
            <div class="col s4 m3 xl2 grey lighten-1 card-panel comment-user-info">
                <img src="{{ post.created_by.profile_image }}" alt="User's profile picture"
                    class="circle responsive-img">
                <span>Code Area</span>
                <div class="switch">
                    <label class="comment deep-purple-text">
                        O
                        <input type="checkbox" id="code_switch" name="code_switch">
                        <span class="lever"></span>
                        I
                    </label>
                </div>
            </div>
            <div class="col s8 m9 xl10">
                <div class="input-field col s12">
                    {% if form.comment_content.errors %}
                    {{ form.comment_content(class="materialize-textarea invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.comment_content.errors %}
                        <span class="red-text">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.comment_content(class="materialize-textarea") }}
                    {% endif %}
                    {{ form.comment_content.label }}
                </div>
                <div class="input-field col s12 visually-hidden code-switch">
                    {{ form.code_language(class="autocomplete") }}
                    {{ form.code_language.label }}
                </div>
                <div class="input-field col s12 visually-hidden code-switch">
                    {% if form.code_content.errors %}
                    {{ form.code_content(class="materialize-textarea grey darken-4 white-text invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.code_content.errors %}
                        <span class="red-text">{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.code_content(class="materialize-textarea grey darken-4 white-text") }}
                    {% endif %}
                    {{ form.code_content.label(class="visually-hidden") }}
                </div>
                {{ form.submit(class="waves-effect waves-light btn yellow") }}
            </div>
        </fieldset>
    </form>
</div>
{% endif %}
{% endblock %}